<div class="invoice-form-container container mt-4">
	<form [formGroup]="invoiceForm" (ngSubmit)="saveInvoice()">
		<div class="form-header mb-3">
			<h2 class="mb-0">{{ isEditMode ? 'Edit Invoice' : 'New Invoice' }}</h2>
			<div class="d-flex align-items-center">
				<label for="invoiceType" class="me-2 mb-0">Invoice Type</label>
				<select formControlName="type" id="invoiceType" (change)="onInvoiceTypeChange()"
					class="form-select form-select-sm" aria-label="Invoice Type">
					<option value="" disabled selected>Choose the Invoice Type</option>
					<option value="1">Retail</option>
					<option value="2">Freelance</option>
					<option value="3">Services</option>
				</select>
			</div>
		</div>

		<!-- Invoice Info -->
		<div class="card mb-3">
			<div class="card-header">
				<h4 class="card-title mb-0">Invoice Information</h4>
			</div>
			<div class="card-body">
				<div class="row gx-3 gy-1">
					<div class="col-md-3">
						<label for="invoiceNumber">Invoice Number</label>
						<input formControlName="invoiceNumber" id="invoiceNumber" type="text" class="form-control" />
					</div>
					<div class="col-md-3">
						<label for="poNumber">PO Number</label>
						<input formControlName="poNumber" id="poNumber" type="text" class="form-control" />
					</div>
					<div class="col-md-3">
						<label for="invoiceDate">Invoice Date</label>
						<input formControlName="invoiceDate" id="invoiceDate" type="text" class="form-control" />
					</div>
					<div class="col-md-3">
						<label for="dueDate">Invoice Date</label>
						<input formControlName="dueDate" id="dueDate" type="date" class="form-control" />
					</div>
				</div>
			</div>

		</div>
		<!-- Seller Info -->
		<div class="card mb-3">
			<div class="card-header">
				<h4 class="card-title mb-0">Your Business Information</h4>
			</div>
			<fieldset formGroupName="sellerInfo">
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<legend>General Information</legend>
							<div class="row gx-3 gy-1">
								<div class="col-12">
									<label for="sellerBusinessName">Business Name</label>
									<input formControlName="businessName" id="sellerBusinessName" type="text" class="form-control" />
								</div>
								<div class="col-md-6">
									<label for="sellerEmail">Email</label>
									<input formControlName="businessEmail" id="sellerEmail" type="email" class="form-control" />
								</div>
								<div class="col-md-6">
									<label for="sellerPhone">Phone</label>
									<input formControlName="businessPhone" id="sellerPhone" type="text" class="form-control" />
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<fieldset formGroupName="businessAddress">
								<legend>Address</legend>
								<div class="row gx-3 gy-1">
									<div class="col-12">
										<label for="sellerStreet">Street</label>
										<input formControlName="street" id="sellerStreet" type="text" class="form-control" />
									</div>

									<div class="col-md-6">
										<label for="sellerCity">City</label>
										<input formControlName="city" id="sellerCity" type="text" class="form-control" />
									</div>
									<div class="col-md-4">
										<label for="sellerState">State</label>
										<input formControlName="state" id="sellerState" type="text" class="form-control" />
									</div>
									<div class="col-md-2">
										<label for="sellerZip">Zip Code</label>
										<input formControlName="zip" id="sellerZip" type="text" class="form-control" />
									</div>
								</div>
							</fieldset>
						</div>
					</div>
				</div>
			</fieldset>
		</div>

		<!-- Customer Info -->
		<div class="card">
			<div class="card-header">
				<h4 class="card-title mb-0">Customer Information</h4>
			</div>
			<fieldset formGroupName="customerInfo">
				<div class="card-body">
					<div class="row gx-3 gy-1 mb-3">
						<div class="col-md-6">
							<label for="customerName">Name</label>
							<input formControlName="customerName" id="customerName" type="text" class="form-control" />
						</div>
						<div class="col-md-3">
							<label for="customerEmail">Email</label>
							<input formControlName="email" id="customerEmail" type="email" class="form-control" />
						</div>
						<div class="col-md-3">
							<label for="customerPhone">Phone</label>
							<input formControlName="phone" id="customerPhone" type="text" class="form-control" />
						</div>
					</div>
					<div class="row gx-3 gy-1">
						<div class="col-md-6">

							<fieldset formGroupName="billingAddress">
								<legend>Billing Address</legend>
								<div class="row gx-3 gy-1">
									<div class="col-12">
										<label for="customerBillingStreet">Street</label>
										<input formControlName="street" id="customerBillingStreet" type="text" class="form-control" />
									</div>
									<div class="col-md-6">
										<label for="customerBillingCity">City</label>
										<input formControlName="city" id="customerBillingCity" type="text" class="form-control" />
									</div>
									<div class="col-md-4">
										<label for="customerBillingState">State</label>
										<input formControlName="state" id="customerBillingState" type="text" class="form-control" />
									</div>
									<div class="col-md-2">
										<label for="customerBillingZip">Zip Code</label>
										<input formControlName="zip" id="customerBillingZip" type="text" class="form-control" />
									</div>
								</div>
							</fieldset>
						</div>

						<div class="col-md-6">
							<fieldset formGroupName="shippingAddress">
								<legend>Shipping Address</legend>
								<div class="row gx-3 gy-1">
									<div class="col-12">
										<label for="customerShippingStreet">Street</label>
										<input formControlName="street" id="customerShippingStreet" type="text" class="form-control" />
									</div>
									<div class="col-md-6">
										<label for="customerShippingCity">City</label>
										<input formControlName="city" id="customerShippingCity" type="text" class="form-control" />
									</div>
									<div class="col-md-4">
										<label for="customerShippingState">State</label>
										<input formControlName="state" id="customerShippingState" type="text" class="form-control" />
									</div>
									<div class="col-md-2">
										<label for="customerShippingZip">Zip Code</label>
										<input formControlName="zip" id="customerShippingZip" type="text" class="form-control" />
									</div>
								</div>
							</fieldset>
						</div>
					</div>
				</div>
			</fieldset>


		</div>

		<!-- Items -->
		<div formArrayName="items" class="card form-line-items mt-3">
			<div class="card-header">
				<h4 class="card-title mb-0">Items</h4>
			</div>

			<div class="card-body">
				<table class="table table-striped table-bordered table-sm align-middle">
					<thead>
						<tr>
							<th style="width:50%;">{{ itemDescriptionLabel }}</th>
							<th *ngIf="showItemQuantity" class="text-center">{{ itemQuantityLabel }}</th>
							<th class="text-center">{{ itemPriceLabel }}</th>
							<th class="text-center">Total</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let item of items.controls; let i = index" [formGroupName]="i">
							<td>
								<input formControlName="description" id="itemDescription-{{ i }}" type="text"
									class="form-control item-description" />
							</td>
							<td *ngIf="showItemQuantity">
								<input formControlName="quantity" id="itemQuantity-{{ i }}" type="text"
									class="form-control item-quantity mx-auto text-center"  (change)="calculateTotals()"/>
							</td>
							<input *ngIf="!showItemQuantity" formControlName="quantity" id="itemQuantity-{{ i }}" type="hidden"
								class="d-none" />
							<td>
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
										<input formControlName="price" id="itemPrice-{{ i }}" type="text" 
											class="form-control item-price text-end float-end" (change)="calculateTotals()" />
									</div>	
							</td>
							<td>
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
								<input formControlName="lineTotal" id="itemLineTotal-{{ i }}" type="text" readonly
									class="form-control item-total text-end float-end"/>
									</div>
							</td>
							<td class="line-actions text-center">
								<button type="button" class="btn btn-danger btn-sm" (click)="removeItem(i)">
									Remove <i class="bi bi-trash"></i>
								</button>
							</td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td *ngIf="showItemQuantity" colspan="4"></td>
							<td *ngIf="!showItemQuantity" colspan="3"></td>
							<td class="line-actions text-center">
								<button type="button" class="btn btn-sm btn-primary" (click)="addItem()">
									Add Item <i class="bi bi-plus-circle-fill"></i>
								</button>
							</td>

						</tr>
					</tfoot>
				</table>


			</div>

		</div>

		<!-- Notes and Totals -->
		<div class="row mt-3 gx-3 gy-1">
			<div class="col-lg-5">
				<div class="card">
					<div class="card-body">
						<div class="form-group">
							<label for="notes">Notes and Terms</label>
							<textarea formControlName="notes" id="notes" class="form-control" rows="3"></textarea>
						</div>
					</div>
				</div>
			</div>

			<!-- Invoice Totals -->
			<div class="col-lg-7">
				<div class="card">
					<div class="card-body">

						<div class="row mb-3">
							<label for="invoiceSubTotal" class="offset-md-5 col-md-3 col-form-label text-md-end">
								Sub Total:
							</label>
							<div class="col-md-4">
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
									<input formControlName="invoiceSubTotal" id="invoiceSubTotal" type="text" 
										class="form-control text-end" readonly />
								</div>

							</div>
						</div>

						<div class="row mb-3">
							<label for="discount" class="offset-md-5 col-md-3 col-form-label text-md-end">
								Discount:
							</label>
							<div class="col-md-4">
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
									<input formControlName="discount" id="discount" type="text" 
										class="form-control text-end" (change)="calculateTotals()" />
								</div>

							</div>
						</div>

						<div class="row mb-3">
							<label for="taxRate" class="col-md-3 col-form-label text-md-end">Tax Rate:</label>
							<div class="col-md-3">
								<div class="input-group">
									<input formControlName="taxRate" id="taxRate" type="text" 
										class="form-control text-end" (change)="calculateTotals()" />
									<span class="input-group-text">%</span>
								</div>

							</div>
							<label for="invoiceTaxTotal" class="col-md-2 col-form-label text-md-end">Tax Total:</label>
							<div class="col-md-4 text-end">
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
									<input formControlName="invoiceTaxTotal" id="invoiceTaxTotal" type="text" 
										class="form-control text-end" readonly />
								</div>
							</div>
						</div>

						<div class="row mb-3">
							<label for="invoiceTotal" class="offset-md-5 col-md-3 col-form-label text-md-end">
								Total
							</label>
							<div class="col-md-4 text-end">
								<div class="input-group">
									<span class="input-group-text">{{ localCurrencySymbol }}</span>
									<input formControlName="invoiceTotal" id="invoiceTotal" type="text" 
										class="form-control text-end" readonly />
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Buttons -->
		<div class="row my-3 g-2">
			<div class="col-12 text-end">				
				<button type="button" class="btn btn-secondary mx-1" (click)="cancel()">Cancel</button>
				<button type="submit" class="btn btn-success mx-1">Save Invoice</button>
				<button type="button" class="btn btn-primary mx-1" (click)="createCsv()">Create CSV</button>
				<button type="button" class="btn btn-primary mx-1" (click)="createPdf()">Create PDF</button>

	
			</div>
		</div>
	</form>
</div>